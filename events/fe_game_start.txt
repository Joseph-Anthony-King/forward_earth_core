namespace = fe

### fe.00 - Set forwardEarth global flag
event = {
	id = fe.00
	hide_window = yes
	is_triggered_only = yes
	fire_only_once = yes
	immediate = { 
        set_global_flag = forwardEarthModEnabled
        log = "ForwardEarth mod loaded..."
    }
}

### fe.01 - Rename binary planet barycenters
event = {
    id = fe.01
    hide_window = yes
    is_triggered_only = yes

    immediate = {

        every_galaxy_planet = {
            limit = {
                has_planet_flag = planetary_barrycenter              
            }
            set_name = "NAME_Empty"
        }
        log = "Binary planet barrycenters renamed..."
    }
}

### fe.02 - Spawn Sagittarius A*
event = {
	id = fe.02
	hide_window = yes
	is_triggered_only = yes

	immediate = {

		no_scope = {
            spawn_system = {
                min_distance = 1
                max_distance = 1
                initializer = sagittarius_a_star_initializer
				hyperlane = no
            }
		}
                    
        random_system = {
            limit = {
                has_star_flag = galactic_center             
            }

            spawn_natural_wormhole = {
                bypass_type = wormhole
                random_pos = no
                orbit_angle = 360
            }
                    
            random_system = {
                spawn_natural_wormhole = {
                    bypass_type = wormhole
                    random_pos = no
                    orbit_angle = 360
                }
                link_wormholes = prev
            }
        }

        log = "Sagittarius A* spawned..."
    }
}

### fe.03 - Spawn Trantor
event = {
	id = fe.03
	hide_window = yes
	is_triggered_only = yes

	immediate = {

		no_scope = {

            if = {
                
                limit = {
                    galaxy_size = tiny
                }
            
                spawn_system = {
                    min_distance = 20
                    max_distance = 20
                    initializer = trantor_initializer
                }
                add_extra_hyperlane_to_spawned_system_effect = yes
            }

            if = {
                
                limit = {
                    galaxy_size = small
                }
            
                spawn_system = {
                    min_distance = 44
                    max_distance = 44
                    initializer = trantor_initializer
                }
                add_extra_hyperlane_to_spawned_system_effect = yes
            }

            if = {
                
                limit = {
                    galaxy_size = medium
                }
            
                spawn_system = {
                    min_distance = 60
                    max_distance = 60
                    initializer = trantor_initializer
                }
                add_extra_hyperlane_to_spawned_system_effect = yes
            }

            if = {
                
                limit = {
                    OR = {
                        galaxy_size = large
                        galaxy_size = huge
                    }
                }
            
                spawn_system = {
                    min_distance = 70
                    max_distance = 70
                    initializer = trantor_initializer
                }
                add_extra_hyperlane_to_spawned_system_effect = yes
            }

            if = {
                
                limit = {
                    OR = {
                        galaxy_size = gigantic
                        galaxy_size = immense
                    }
                }
            
                spawn_system = {
                    min_distance = 80
                    max_distance = 80
                    initializer = trantor_initializer
                }
                add_extra_hyperlane_to_spawned_system_effect = yes
            }
		}
        log = "Trantor spawned..."
    }
}

### fe.04 - Spawn Terminus
event = {
	id = fe.04
	hide_window = yes
	is_triggered_only = yes

	immediate = {

		no_scope = {

            if = {
                
                limit = {
                    galaxy_size = tiny
                }
            
                spawn_system = {
                    min_distance = 216
                    max_distance = 218
                    initializer = terminus_initializer
                }
                add_extra_hyperlane_to_spawned_system_effect = yes
            }

            if = {
                
                limit = {
                    galaxy_size = small
                }
            
                spawn_system = {
                    min_distance = 316
                    max_distance = 318
                    initializer = terminus_initializer
                }
                add_extra_hyperlane_to_spawned_system_effect = yes
            }

            if = {
                
                limit = {
                    galaxy_size = medium
                }
            
                spawn_system = {
                    min_distance = 416
                    max_distance = 418
                    initializer = terminus_initializer
                }
                add_extra_hyperlane_to_spawned_system_effect = yes
            }

            if = {
                
                limit = {
                    OR = {
                        galaxy_size = large
                        galaxy_size = huge
                    }
                }
            
                spawn_system = {
                    min_distance = 478
                    max_distance = 480
                    initializer = terminus_initializer
                }
                add_extra_hyperlane_to_spawned_system_effect = yes
            }

            if = {
                
                limit = {
                    OR = {
                        galaxy_size = gigantic
                        galaxy_size = immense
                    }
                }
            
                spawn_system = {
                    min_distance = 518
                    max_distance = 520
                    initializer = terminus_initializer
                }
                add_extra_hyperlane_to_spawned_system_effect = yes
            }
		}
        log = "Terminus spawned..."
    }
}

### fe.05 - Instantiate Earth if not done so yet
event = {
	id = fe.05
	hide_window = yes
	is_triggered_only = yes

	immediate = {

		if = {
			# If there are no Sols
			limit = {
				NOT = {
					any_system = {
						has_star_flag = sol
					}
				}
			}
			random_list = {
				75 = {
					random_system = {
						limit = { has_owner = no }
						spawn_system = { initializer = "special_init_03" }
					}
				}
				25 = {
					random_system = {
						limit = { has_owner = no }
						spawn_system = { initializer = "special_init_04" }
					}
				}
			}
            log = "Sol spawned..."
		}
        else = {
            log = "Sol already spawned..."
        }
    }
}

### fe.06 - Spawn LHC and CoA for UNE
event = {
	id = fe.06
	hide_window = yes
	is_triggered_only = yes

	immediate = {		

        if = {
            random_country = {
                limit = {
                    AND = {
                        has_country_flag = human_1
                        num_ai_empires_setting > 1
                    }
                }

                random_country = {
                    limit = { has_country_flag = human_1 }
                    owner_species = { save_event_target_as = human_species }
                }

                random_galaxy_planet = {
                    limit = {
                        AND = {
                            not = { any_country = { has_country_flag = custodian_faction } }
                            not = { any_country = { has_country_flag = icarus_faction } }
                            any_country = { has_country_flag = human_1 }
                            has_planet_flag = 40_eridani_a_two
                        }                
                    }

                    create_country = {
                        name = "NAME_League_of_Human_Colonies"
                        name_list = HUMAN1              
                        ship_prefix = "LHCS"
                        
                        authority = auth_oligarchic
                        
                        origin = "origin_lost_colony"

                        species = event_target:human_species
                        ethos = {
                            ethic = ethic_authoritarian
                            ethic = ethic_fanatic_militarist
                        }
                        civics = {
                            civic = civic_cutthroat_politics
                            civic = civic_warrior_culture
                        }
                        flag = {
                            icon = {
                                category="spherical"
                                file="flag_spherical_8.dds"
                            }
                            background = {
                                category="backgrounds"
                                file="vertical.dds"
                            }
                            colors = {
                                "dark_green"
                                "yellow"
                                "null"
                                "null"
                            }
                        }
                        type = default
                                
                        effect = {
                            save_global_event_target_as = npc_LHC
                            add_resource = {
                                minerals = 0
                                energy = 0
                                food = 0
                                alloys = 0
                                consumer_goods = 0
                                influence = 0
                            }
                        }
                    }

                    event_target:npc_LHC = {
                        set_country_flag = human_3
                        set_country_flag = human_faction
                        save_global_event_target_as = npc_LHC
                    }
                    
                    set_owner = event_target:npc_LHC

                    while = {
                        count = 14
                        create_pop = {
                            species = event_target:human_species
                        }
                    }

                    set_owner = last_created_country
                    set_capital = yes
                    add_district = district_farming
                    add_district = district_farming
                    add_district = district_mining
                    add_district = district_generator
                    add_building = building_capital

                    last_created_country = {
                        capital_scope = { set_name = "40 Eridani A II" }
                        set_graphical_culture = mammalian_01
                    }

                    log = "LHC spawned..."
                }
                    
                random_galaxy_planet = {
                    limit = {
                        AND = {
                            not = { any_country = { has_country_flag = human_2 } }
                            not = { any_country = { has_country_flag = custodian_faction } }
                            not = { any_country = { has_country_flag = icarus_faction } }
                            any_country = { has_country_flag = human_1 }
                            has_planet_flag = planet_aurora
                        }                
                    }

                    random_list = {

                        90 = {

                            create_country = {
                                name = "NAME_Commonwealth_of_Aurora"
                                name_list = HUMAN2               
                                ship_prefix = "CAS"
                                
                                authority = auth_oligarchic
                                
                                origin = "origin_lost_colony"

                                species = event_target:human_species
                                ethos = {
                                    ethic = ethic_militarist
                                    ethic = ethic_fanatic_materialist
                                }
                                civics = {
                                    civic = civic_meritocracy
                                    civic = civic_citizen_service
                                }
                                flag = {
                                    icon = {
                                        category="human"
                                        file="flag_human_zca.dds"
                                    }
                                    background = {
                                        category="backgrounds"
                                        file="circle.dds"
                                    }
                                    colors = {
                                        "red"
                                        "black"
                                        "null"
                                        "null"
                                    }
                                }
                                type = default
                                
                                effect = {
                                    save_global_event_target_as = npc_CoA
                                    add_resource = {
                                        minerals = 200
                                        energy = 200
                                        food = 200
                                        alloys = 100
                                        consumer_goods = 100
                                        influence = 100
                                    }
                                }
                            }

                            create_colony = {
                                owner = event_target:npc_CoA
                                species = event_target:human_species	
                                ethos = {	
                                    ethic = ethic_xenophobe
                                    ethic = ethic_fanatic_militarist			
                                }	
                            }

                            last_created_country = {
                                capital_scope = { set_name = "Aurora" }
                                set_graphical_culture = humanoid_01
                            }

                            solar_system = {

                                # starbase
                                create_starbase = {
                                    size = starbase_starport
                                    module = shipyard
                                    module = trading_hub
                                    building = crew_quarters
                                    owner = event_target:npc_CoA
                                }
                            }

                            event_target:npc_CoA = {
                                set_country_flag = human_2
                                set_country_flag = human_faction
                                save_global_event_target_as = CoA
                                create_starting_leaders = yes
                                country_event = { id = game_start.9 }
                                country_event = { id = game_start.33 days = 1 } # needs delay for system ownership to settle
                            }
                            
                            set_owner = event_target:npc_CoA

                            while = {	
                                count = 19	
                                create_pop = {	
                                    species = event_target:human_species
                                }	
                            }
                            
                            create_species = {	
                                name = "NAME_Robot"	
                                plural = "NAME_Robots"	
                                class = ROBOT	
                                namelist = MACHINE3	
                                portrait = "default_robot"	
                                traits = {	
                                    trait = trait_mechanical
                                }	
                            }	

                            while = {	
                                count = 8	
                                create_pop = {	
                                    species = last_created	
                                }	
                            }                        

                            set_owner = last_created_country	
                            set_capital = yes

                            generate_start_deposits_and_blockers = yes
                            generate_start_buildings_and_districts = yes
                            
                            add_district = district_generator
                            add_district = district_generator
                            add_district = district_generator                           	
                            add_building = building_robot_assembly_plant

                            create_army = {	
                                name = "1st Colonial Gendarmerie"	
                                owner = event_target:npc_CoA
                                species = event_target:human_species	
                                type = "defense_army"	
                            }	
                            create_army = {	
                                name = "2nd Colonial Gendarmerie"	
                                owner = event_target:npc_CoA
                                species = event_target:human_species	
                                type = "defense_army"	
                            }

                            log = "CoA spawned..."
                        }
                        10 = {
                            log = "CoA not instantiated..."
                        }
                    }
                }
            }
        }
        else = {
            log = "UNE not instantiated..."
        }
    }
}

### fe.07 - Set Forward Earth planet modifiers
event = {
	id = fe.07
	hide_window = yes
	is_triggered_only = yes

	immediate = {

        every_galaxy_planet = {

            limit = { has_planet_flag = planet_tau_ceti_3a }
            add_modifier = {
                modifier = "strong_magnetic_field"
                days = -1
            }
        }

        every_galaxy_planet = {

            limit = { has_planet_flag = planet_tau_ceti_3b }
            add_modifier = {
                modifier = "lush_planet"
                days = -1
            }
            add_modifier = {
                modifier = "strong_magnetic_field"
                days = -1
            }
        }

        every_galaxy_planet = {

            limit = { has_planet_flag = 40_eridani_a_two }
            add_modifier = {
                modifier = "high_gravity"
                days = -1
            }
            add_modifier = {
                modifier = "strong_magnetic_field"
                days = -1
            }
            change_pc = pc_desert
            set_planet_entity = { entity = "desert_planet_02_entity" }
        }

        every_galaxy_planet = {

            limit = { has_planet_flag = planet_aurora }
            add_modifier = {
                modifier = "strong_magnetic_field"
                days = -1
            }
        }

        every_galaxy_planet = {

            limit = { has_planet_flag = planet_tithonus }
            add_modifier = {
                modifier = "strong_magnetic_field"
                days = -1
            }
        }

        log = "Forward Earth planets modified..."
    }
}

### fe.08 - Revert Eta Cassiopeiae to default names if unpopulated
event = {
	id = fe.08
	hide_window = yes
	is_triggered_only = yes

	immediate = {

        random_galaxy_planet = {
            limit = {
                AND = {
                    NOT = { any_country = { has_country_flag = human_2 } }
                    has_planet_flag = planet_inferno
                }                
            }
            set_name = "Eta Cassiopeiae A I"
        }

        random_galaxy_planet = {
            limit = {
                AND = {
                    NOT = { any_country = { has_country_flag = human_2 } }
                    has_planet_flag = planet_astraeus
                }                
            }
            set_name = "Eta Cassiopeiae A II"
        }

        random_galaxy_planet = {
            limit = {
                AND = {
                    NOT = { any_country = { has_country_flag = human_2 } }
                    has_planet_flag = planet_notus
                }                
            }
            set_name = "Eta Cassiopeiae A IIa"
        }

        random_galaxy_planet = {
            limit = {
                AND = {
                    NOT = { any_country = { has_country_flag = human_2 } }
                    has_planet_flag = planet_eurus
                }                
            }
            set_name = "Eta Cassiopeiae A IIb"
        }

        random_galaxy_planet = {
            limit = {
                AND = {
                    NOT = { any_country = { has_country_flag = human_2 } }
                    has_planet_flag = planet_aurora
                }                
            }
            set_name = "Eta Cassiopeiae A IIIa"
        }

        random_galaxy_planet = {
            limit = {
                AND = {
                    NOT = { any_country = { has_country_flag = human_2 } }
                    has_planet_flag = planet_tithonus
                }                
            }
            set_name = "Eta Cassiopeiae A IIIb"
        }

        random_galaxy_planet = {
            limit = {
                AND = {
                    NOT = { any_country = { has_country_flag = human_2 } }
                    has_planet_flag = planet_anemoi
                }                
            }
            set_name = "Eta Cassiopeiae A IV"
        }

        random_galaxy_planet = {
            limit = {
                AND = {
                    NOT = { any_country = { has_country_flag = human_2 } }
                    has_planet_flag = planet_boreas
                }                
            }
            set_name = "Eta Cassiopeiae A IVa"
        }

        random_galaxy_planet = {
            limit = {
                AND = {
                    NOT = { any_country = { has_country_flag = human_2 } }
                    has_planet_flag = planet_zephyrus
                }                
            }
            set_name = "Eta Cassiopeiae A IVb"
        }

        random_galaxy_planet = {
            limit = {
                AND = {
                    NOT = { any_country = { has_country_flag = human_2 } }
                    has_planet_flag = planet_hyperion
                }                
            }
            set_name = "Eta Cassiopeiae A V"
        }

        random_galaxy_planet = {
            limit = {
                AND = {
                    NOT = { any_country = { has_country_flag = human_2 } }
                    has_planet_flag = planet_selene
                }                
            }
            set_name = "Eta Cassiopeiae A Va"
        }

        random_galaxy_planet = {
            limit = {
                AND = {
                    NOT = { any_country = { has_country_flag = human_2 } }
                    has_planet_flag = planet_jackson_s_planet
                }                
            }
            set_name = "Eta Cassiopeiae B I"
        }

        random_galaxy_planet = {
            limit = {
                AND = {
                    NOT = { any_country = { has_country_flag = human_2 } }
                    has_planet_flag = planet_olympus
                }                
            }
            set_name = "Eta Cassiopeiae B II"
        }

        random_galaxy_planet = {
            limit = {
                AND = {
                    NOT = { any_country = { has_country_flag = human_2 } }
                    has_planet_flag = planet_horae
                }                
            }
            set_name = "Eta Cassiopeiae B IIb"
        }

        if = {
            limit = {
                NOT = { any_country = { has_country_flag = human_2 } } 
            }

            log = "Eta Cassiopeiae system names set to defaults..."
        }
        else = {
            log = "human_2 faction instantiated..."
        }

    }
}

### fe.09 - Ensure homeworld for LHC and CoA is set to Earth
event = {
    id = fe.09
    hide_window = yes
    is_triggered_only = yes

	immediate = {

        random_galaxy_planet = {
            limit = {
                has_planet_flag = planet_earth             
            }
            random_country = {
                limit = {
                    and = {
                        has_country_flag = human_2
                        is_ai = no
                    }
                }
				owner_species = {
					set_species_homeworld = prevprev
				}

                log = "CoA homeworld reset..."
            }
        }

        random_galaxy_planet = {
            limit = {
                has_planet_flag = planet_earth             
            }
            random_country = {
                limit = {
                    and = {
                        has_country_flag = human_3
                        is_ai = no
                    }
                }
				owner_species = {
					set_species_homeworld = prevprev
				}

                log = "LHC homeworld reset..."
            }
        }
    }
}
